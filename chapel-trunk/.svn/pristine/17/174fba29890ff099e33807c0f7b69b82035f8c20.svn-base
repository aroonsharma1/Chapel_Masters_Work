#!/usr/bin/env perl

use FindBin;
use lib $FindBin::Bin;
use Run qw(run);
use strict;

my $platform = run("platform", "--target");

if ($platform =~ /^cray-(xc|xe)$/) {
  my $comm = run("comm", "--target");
  my $substrate = run("commSubstrate", "--target");
  if ($comm eq "gasnet") {
    if ($substrate eq "gemini" || $substrate eq "aries") {
      if ($ENV{'PE_PRODUCT_LIST'} =~ "HUGETLB") {
        print("warning: compiling with the craype-hugepages module while using the GASNet $substrate conduit is not supported and will lead to link errors.\n");
      }
    }
  } elsif ($comm eq "ugni") {
    if ($ENV{'PE_PRODUCT_LIST'} !~ "HUGETLB") {
      print("warning: a craype-hugepages module must be loaded when using the $comm communication layer, or link errors will result.\n");
    }
  }
}

